echo            both

#----------------------------------------------#
#-------------- BULK SIMULATION ---------------#
#----------------------------------------------#

# ---------- INPUT ----------
# Molecule data
variable        MolData     string "Methane.TraPPE-UA"	
variable        N           equal 400                   # Nr. of molecules
# Read data
variable        i_ReadData  equal 0                     # 0 - create atoms, 1,2,3,... - read data file
variable        file        string "Bulk_NVE"           # Data file to read (just file ending)
# State point
variable        tmp_start   equal 130                   # Temperature [K]
variable        rho_in      equal 0.4                   # Density [g/mol] (if 0, density remains as in input -> just possible for i_ReadData > 0)
variable        x1          equal 0.5                   # Mole fraction component 1
variable        x2          equal 0.5                   # Mole fraction component 2 ...
# Numerics
variable        dt          equal 0.001
variable        n_run       equal 1e5                   # NpT run
variable        n_equ       equal 1e4                   # Nr. of ts before production run
# Ensemble string
variable        ensemble    string "NVE"
# ---------------------------

# ---------- Simulation setup ---------
variable        norun       equal ${i_ReadData}+1
variable        is_vle      equal 0

# Set simulation conditions
units           metal
atom_style      full

dimension       3
atom_modify     map array
boundary        p p p
neighbor        2 bin
neigh_modify    every 1 delay 0 check yes

# Set timestep
timestep        ${dt}

# Define lower start density
variable        rho_start equal 0.5*${rho_in}

include         ${MolData}.inMolData

# Set density by setting box length
variable 		factor_L equal "(density / v_rho_in)^(1/3)"
if "${rho_in} == 0 && ${i_ReadData} == 0" then "quit"
if "${rho_in} != 0" then &
    "change_box 		all x scale ${factor_L} y scale ${factor_L} z scale ${factor_L} remap"

# Set velocity atoms defined by temperature
if "${i_ReadData} == 0" then "velocity all create ${tmp_start} $$"

# ---------- Minimize Eenergy ---------
if "${i_ReadData} == 0" then   "minimize   0.001 1.0e-4 1000 10000"

# -------------- MD NVE ---------------
# Log File
thermo          1000
thermo_style    custom step atoms vol temp press density etotal pe ke

# Ensemble Setup and Shake Fix
if "${do_shake} == 1" then      "fix        shk all shake 1e-5 100 10000 b $$"
fix             NVE all nve

# --- Equilibration ---
run             ${n_equ}

# --- Actual Run ---
reset_timestep  0

# Output
include         in.ThermoOutput

run             ${n_run}

if "${do_shake} == 1" then      "unfix      shk"
unfix           NVE

# Write Data File
write_data      data.${norun}.Bulk_NVE nocoeff nofix

shell           mv log.lammps log.${norun}.Bulk_NVE